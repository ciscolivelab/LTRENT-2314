<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Lab 1 Tasks - HOLENT-2314 Advanced SD-WAN Lab</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Lab 1 Tasks";
        var mkdocs_page_input_path = "lab1.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> HOLENT-2314 Advanced SD-WAN Lab
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="..#preface">Preface</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="..#audience">Audience</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="..#speakers">Speakers</a>
    </li>
    </ul>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Lab Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../access/">Lab Access</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../access/#lab-flow">Lab Flow</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../access/#lab-access">Lab Access</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../access/#lab-topology">Lab Topology</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../intro2/">Getting Started</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../intro2/#lab-design">Lab Design</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../intro2/#lab-access">Lab Access</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../intro2/#lab-access-without-anyconnect-vpn">Lab Access without AnyConnect VPN</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Lab 1 Tasks</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#task-1-local-route-policy">Task 1: Local Route Policy</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-11-verification-of-the-routes-received-on-dc-wes">Step 1.1 Verification of the routes received on DC WEs.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-12-verify-the-bgp-communities">Step 1.2 Verify the BGP communities.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-13-set-the-omp-tag-for-dc-specific-routes">Step 1.3 set the OMP tag for DC specific Routes</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-14-creating-a-local-policy">Step 1.4 Creating a Local Policy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-15-apply-the-route-policy">Step 1.5 Apply the route-policy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-16-verify-omp-tags">Step 1.6 Verify OMP Tags</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#task-2-hub-spoke-topologies">Task 2: Hub &amp; Spoke Topologies</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-21-pre-config-verifications">Step 2.1. Pre-config verifications</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-22-create-a-topology-for-centralized-policy">Step 2.2. Create a topology for centralized policy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-23-apply-the-topology-policy-to-centralized-policy">Step 2.3. Apply the topology policy to Centralized Policy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-24-activate-the-first-centralized-policy">Step 2.4. Activate the first Centralized Policy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-25-verify-the-hub-spoke-topology">Step 2.5. Verify the hub &amp; spoke topology</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#task-3-default-route-handling">Task 3: Default Route handling</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-31-new-central-policy">Step 3.1.  New Central Policy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-32-edit-the-new-topology-policy">Step 3.2. Edit the new topology policy.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-33-apply-the-policy">Step 3.3. Apply the policy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-34-verify-change-of-default-route">Step 3.4. Verify change of default route</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-35-create-new-topology">Step 3.5. Create new topology</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-36-verify">Step 3.6. Verify</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-37-create-topology-policy-for-remote2">Step 3.7. Create topology policy for Remote2</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#task-4-specific-routes-handling">Task 4: Specific Routes handling</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-41-modify-topology-policy-for-remote1">Step 4.1: Modify Topology policy for remote1</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-42-configure-16-paths-ecmp">Step 4.2: Configure 16 paths ECMP</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-43-verification">Step 4.3: Verification</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-44-modify-topology-policy-for-remote2">Step 4.4: Modify Topology policy for remote2</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-45-verification">Step 4.5: Verification</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#this-concludes-the-routing-handling-for-the-specific-routes">This concludes the routing handling for the specific routes.</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#task-5-application-aware-routing">Task 5: Application Aware Routing</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-51-configure-the-rh-lte-interface-be-used-only-when-all-other-circuits-are-unavailable">Step 5.1: Configure the RH LTE interface be used only when all other circuits are unavailable.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-52-last-resort-verification">Step 5.2: Last-Resort verification.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-53-configure-sla-classes-for-app-aware-routing-aar">Step 5.3: Configure SLA classes for app aware routing (AAR)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-54-apply-the-aar">Step 5.4: Apply the AAR</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-55-lab-verification">Step 5.5: Lab Verification</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../lab2/">Lab 2 Tasks</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../lab2/#step1-verify-current-route">Step1: Verify current route</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../lab2/#step2-route-policy-for-remote2">Step2: Route policy for Remote2</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../lab2/#step3-route-policy-for-remote1">Step3: Route policy for Remote1</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../lab3/">Lab 3 Tasks</a>
    <ul>
    <li class="toctree-l2"><a class="reference internal" href="../lab3/#task-1-qos">Task 1: QoS</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-11-class-map-and-applications">Step 1.1: class map and applications</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-12-central-data-policy-for-classification">Step 1.2: Central Data Policy for classification</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-13-local-qos-queuing-policy">Step 1.3: Local QoS queuing policy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-14-apply-qos-queuing-policy">Step 1.4: Apply QoS queuing policy</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../lab3/#task-2-per-tunnel-qos">Task 2: per-tunnel QoS</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-21-configure-qos-policy-on-rh">Step 2.1: Configure QoS policy on RH</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-22-configure-hub-role-on-rh">Step 2.2: Configure Hub role on RH</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-23-configure-spoke-role-on-remotes">Step 2.3: Configure Spoke role on Remotes</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-24-verify-per-tunnel-qos">Step 2.4: Verify per-tunnel QOS</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../lab3/#task-3-on-demand-tunnel">Task 3: On-demand Tunnel</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-31-modify-central-control-policy">Step 3.1: Modify central control policy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-32-configure-on-demand-tunnel">Step 3.2: Configure On-demand Tunnel</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-33-verify-on-demand-tunnel-between-remotes">Step 3.3: Verify On-demand Tunnel between remotes</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../lab3/#task-4-ipsec-tunnel-to-sig">Task 4: IPsec tunnel to SIG</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-41-manual-ipsec-tunnel-to-sig">Step 4.1 : Manual IPSec tunnel to SIG</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-42-verify-sig-tunnel">Step 4.2 : verify SIG tunnel</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../lab3/#task-5-dia">Task 5: DIA</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-51-verify-route-to-internet">Step 5.1: verify route to internet</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-52-enable-nat-on-lte-transport">Step 5.2: Enable NAT on LTE transport</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-53-add-nat-route-on-vpn-1">Step 5.3: Add NAT route on VPN 1</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../lab3/#task-6-cor-for-saas">Task 6: CoR for SaaS</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-61-enable-cloud-onramp-for-saas">Step 6.1 Enable Cloud OnRamp for SaaS</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-62-add-saas-application">Step 6.2 Add SaaS application</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-63-add-sites">Step 6.3 Add sites</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="../lab3/#step-64-verify-cor-saas">Step 6.4 Verify CoR SaaS</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="../lab3/#congratulation-you-have-completed-the-whole-lab">Congratulation! You have completed the whole lab.</a>
    </li>
    </ul>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../survey/">Survey</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">HOLENT-2314 Advanced SD-WAN Lab</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Lab Guide &raquo;</li><li>Lab 1 Tasks</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="lab-1-advanced-routing">Lab 1: Advanced Routing</h1>
<hr />
<p>In this section, you will help ACME on an advanced routing using both local and central policy. You will perform the following tasks.</p>
<ul>
<li>
<p>The ACME DC routers have already tagged all the routes originated from DC1 with BGP community of 65010:1000; all the routes originated from DC2 with BGP community of 65020:2000. <strong>Please configure a route-policy to ensure the default route (0.0.0.0/0) coming from both DCs is set with an OMP tag of 100.</strong> For DC1 routes, set an OMP tag of <strong>1000</strong>; for DC2 routes, set an OMP tag of <strong>2000</strong>. (Lab_Task 1)</p>
</li>
<li>
<p>ACME wants to have a <strong>hub &amp; spoke topology between the Remote sites and DCs as well as between the Remote sites and Regional hubs</strong>. The Hub &amp; spoke topology will scale more by reducing the number of tunnels required on the devices. (Lab_Task 2)</p>
</li>
<li>
<p>ACME has categorized their branches into multiple Business Units(BUs). In the Data Center (DC) sites, the headend WAN Edges(WEs) are also categorized into multiple BUs for the purpose of horizontal scaling in terms of throughputs, therefore remote site only needs to build tunnels to its respective DC hub WEs. <strong>Remote Site1 only needs to build tunnels to DC1-WE1 and DC2-WE1</strong>; <strong>Remote Site 2 only needs to build tunnels to DC1-WE2 and DC2-WE2</strong>.(Lab_Task 2)</p>
</li>
<li>
<p>Remote sites receive a default route from both RH and DC, **DCs will be preferred and load shared. RH's default route will be used as backup for DCs. (Lab_Task 3)</p>
</li>
<li>
<p>Remotes sites receive more specific routes from both DCs, and <strong>routes originated from local DC are preferred</strong>. If one DC goes down, it will use the routes from another DC as backup. In another words, from remote sites perspective, previously tagged routes tagged with 1000 will prefer DC1; routes tagged with 2000 will prefer DC2.(Lab_Task 4)</p>
</li>
<li>
<p>For remote sites to any other region, routes are forced to go through the DCâ€™s functional hub. For <strong>remote site1, it goes through WE1 in DC1 and DC2</strong>; for <strong>remote site 2, it goes through WE2 in DC1 and DC2</strong>.(Lab_Task 4)</p>
</li>
</ul>
<p><span style="background-color:lightblue"> <span style="background-color:lightblue"> <strong>Note: In these lab exercises, it's possible that there are multiple ways to achieve the requirements. The lab guide provides a detailed step by step instruction for each tasks. However you're welcome to solve it with your own solution. Just be mindful with the time.</strong> </span></p>
<h2 id="task-1-local-route-policy">Task 1: Local Route Policy</h2>
<p>In this section, you are going to use localized policy to assign a <strong>tag</strong> for DC specific route as well as the default route. In a later section you are going to create policy based on the <strong>tag</strong>.</p>
<h4 id="step-11-verification-of-the-routes-received-on-dc-wes"><strong>Step 1.1</strong> Verification of the routes received on DC WEs.</h4>
<ul>
<li>SSH to <strong>DC1-WE1, DC1-WE2, DC2-WE1,DC2-WE2</strong> and do <code>show ip route vrf 1</code> and make sure <strong>10.100.100.0/24, 10.200.200/24</strong> as well as <strong>0.0.0.0/0</strong> learned via BGP.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_iproute.png" width="800"/></p>
<h4 id="step-12-verify-the-bgp-communities"><strong>Step 1.2</strong> Verify the BGP communities.</h4>
<ul>
<li>10.100.100.0/24 should tag with 65010:1000; 10.200.200.0/24 should tag with 65020:2000. Execute <code>show ip bgp vpnv4 vrf 1 &lt;prefix&gt;</code> (10.100.100.0/24 and 10.200.200.0/24) on DC1-WE1,DC1-WE2 and DC2-WE1,DC2-WE2.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_bgpcommunity.png" width="800"/></p>
<h4 id="step-13-set-the-omp-tag-for-dc-specific-routes"><strong>Step 1.3</strong> set the OMP tag for DC specific Routes</h4>
<ul>
<li>Login to vManage <strong>https://198.18.133.200:8443</strong> and access policy configuration from <strong>Configuration - Policies</strong></li>
<li>Click <strong>Custom Options</strong> drop down on the top right and select <strong>Route Policy</strong> under <strong>Localized Policy</strong></li>
<li>
<p>Click <strong>Add Route Policy</strong> to Create new</p>
<ul>
<li>Name: <strong>LAB_DCs_BGP_RP</strong>  (write down this name, it will be used later)</li>
<li>Description: <strong>LAB_DCs_BGP_RP</strong></li>
<li>Click <strong>+Sequence Type</strong> on the left then click <strong>+Sequence Rule</strong>, click Match, select <strong>Address</strong>, select <strong>default</strong>.</li>
</ul>
</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_new_lp_1.png" width="800"/></p>
<ul>
<li>Click <strong>Action</strong>, change to <strong>Accept</strong>, then select OMP tag, key in <strong>100</strong>, then save Match and Actions.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_new_lp_2.png" width="800"/></p>
<ul>
<li>
<p>click <strong>Sequence Rule</strong> to create following two rules:</p>
<ul>
<li>Match <strong>community-list DC1_Routes</strong>, <strong>Accept</strong> and Set <strong>OMP Tag 1000</strong></li>
<li>Match <strong>community-list DC2_Routes</strong>, <strong>Accept</strong> and Set <strong>OMP Tag 2000</strong></li>
</ul>
</li>
</ul>
<p><span style="background-color:lightblue"> <span style="background-color:lightblue"> <strong>Note: Match Criteria has option "OR","AND" "EXACT". It makes difference when multiple community lists are used in match condition. In this lab, we are only match one community. You can leave it as default OR option.</strong> </span>
- Click <strong>Default Action</strong> on the left panel, and change default <strong>Reject</strong> action to <strong>Accept</strong></p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab1_1_3_3.PNG" width="800"/></p>
<ul>
<li>Then click on <strong>Save Route Policy</strong></li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_new_lp_3.png" width="800"/></p>
<h4 id="step-14-creating-a-local-policy"><strong>Step 1.4</strong> Creating a Local Policy</h4>
<ul>
<li>Login to vManage <strong>198.18.133.200</strong> and access policy configuration from <strong>Configuration - Policies</strong></li>
<li>Click on <strong>Localized Policy</strong>, then click on <strong>Add Policy</strong></li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_new_lp_4.png" width="800"/></p>
<ul>
<li>Click on Next to proceed till you see <strong>Configure Route Policy</strong>; click <strong>Add Route Policy</strong> then select <strong>Import Existing Policy</strong>; Select <strong>LAB_DCs_BGP_RP</strong> click import</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_new_lp_5.png" width="800"/></p>
<ul>
<li>Click on Next, Key in the following values:<ul>
<li>Policy Name: <strong>LAB_DCs_Local_policy</strong></li>
<li>Policy Description: <strong>LAB_DCs_Local_policy</strong> .</li>
<li>Check <strong>Netflow, Application</strong> and <strong>Implicit ACL Logging</strong>.</li>
<li>Then click on Save Policy (Feel free to click Preview before save)</li>
</ul>
</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_new_lp_6.png" width="800"/></p>
<ul>
<li>
<p>Attach the local policy to the DC device templates <strong>(Lab_DC1_V01 &amp; Lab_DC2_V01)</strong></p>
<ul>
<li>Access template configuration from <strong>Configuration - Templates</strong></li>
<li>Under the <strong>Device</strong> template tab, locate template <strong>Lab_DC1_V01</strong> and select <strong>Edit</strong></li>
<li>Under the <strong>Additional Templates</strong> section, click the dropdown next to <strong>Policy</strong> and select <strong>LAB_DCs_Local_policy</strong>
 <img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab1_1_4_4.PNG" width="800"/></li>
<li>Click <strong>update</strong> and <strong>Next</strong> to configuration change window. Click the checkbox to <strong>Confirm configuration changes</strong> and click OK to push the change.</li>
<li>Under the <strong>Device</strong> template tab, locate template <strong>Lab_DC2_V01</strong> and select <strong>Edit</strong></li>
<li>Under the <strong>Additional Templates</strong> section, click the dropdown next to <strong>Policy</strong> and select <strong>LAB_DCs_Local_policy</strong></li>
<li>Click <strong>update</strong> and <strong>Next</strong> to configuration change window. Click the checkbox to <strong>Confirm configuration changes</strong> and click OK to push the change.</li>
</ul>
<p><span style="background-color:lightblue"> <strong>Note: Verify that you have attached the policy on both DC1&amp;DC2 device-templates before proceeding to the next step.</strong></p>
</li>
</ul>
<h4 id="step-15-apply-the-route-policy"><strong>Step 1.5</strong> Apply the route-policy</h4>
<ul>
<li>Access the feature template configuration from <strong>Configuration - Templates - Feature</strong></li>
<li>Locate the feature template <strong>Lab_DC_VPN1_BGP_V01</strong> and select the three dots on the right side and then click <strong>Edit</strong>.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_bgp_ft_1.png" width="800"/></p>
<ul>
<li>Select the <strong>Neighbor</strong> section, then click on the pencil icon under Action.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_bgp_ft_2.png" width="800"/></p>
<ul>
<li>Update the following:<ul>
<li>Change <strong>Address Family</strong> to Global and set to <strong>On</strong></li>
<li>Change <strong>Address Family</strong> to Global and set to <strong>ipv4-unicast</strong></li>
<li>Change <strong>Route Policy In</strong> to Global and set to <strong>On</strong></li>
<li>Change <strong>Policy Name</strong> changes to Global and set to <strong>LAB_DCs_BGP_RP</strong> (this was the name you wrote down earlier)</li>
</ul>
</li>
<li>Then click on Save changes and Click on Update</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_bgp_ft_3.png" width="800"/></p>
<ul>
<li>Then click Next and then Update. Feel free to review the config changes, then click Configure Devices, then check the Confirm configuration box and click on OK.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_bgp_ft_4.png" width="800"/></p>
<h4 id="step-16-verify-omp-tags"><strong>Step 1.6</strong> Verify OMP Tags</h4>
<ul>
<li>SSH to DC wEdge routers(<strong>DC1-WE1,DC1-WE2,DC2-WE1,DC2-WE2</strong>) and run <strong><code>show ip bgp vpnv4 vrf 1 &lt;prefix&gt;</code></strong> (10.100.100.0/24,10.200.200.0/24)</li>
<li>You should see the proper OMP tags are now set to 1000 and 2000</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task1_bgp_ft_5.png" width="800"/></p>
<h2 id="task-2-hub-spoke-topologies">Task 2: Hub &amp; Spoke Topologies</h2>
<p>In this section, you are going to use a centralized policy to build the hub &amp; spoke topology. This will include the hub on both DCs as well as RH.</p>
<h4 id="step-21-pre-config-verifications"><strong>Step 2.1.</strong> Pre-config verifications</h4>
<ul>
<li>SSH to <strong>R1-WE1</strong> and run the <code>show sdwan omp route vpn 1</code> command.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_Routes_1.png" width="800"/></p>
<p><strong>Question: Do you know why the default route learned from private2 shown as invalid and unreachable (Inv,U)</strong>? </n></p>
<p>This is because R1-WE1 doesn't have a transport with private 2 color. If you check the route on R2-WE1, you should notice the next hop from private 1 marked as <strong>(Inv,U)</strong> for the same reason, because the private 1 color doesn't exist on R2-WE1.</p>
<p><strong>Question: Did you notice the default route is learned from 1.1.30.1 which is the Regional Hub(RH)? Do you know why?</strong> </n></p>
<p>To answer this question, we will check the route table at vSmart as all the routes are advertised by vSmart. SSH to vSmart and run <code>show omp route vpn 1 0.0.0.0/0 detail | t</code></p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_Routes_2.png" width="800"/></p>
<p>OMP is very much like BGP when it comes down to route preference. In the order of preference, there is an origin-protocol, in this case the default route learned on RH is from Static (by design, in real deployment, it's probably going to be BGP as well); whereas the default learned from the DCs is from iBGP. The Origin protocol static route is more preferred than iBGP.</p>
<p>Now, let's look at the specific routes learned from DC. Do <code>show sdwan omp route vpn 1 10.100.100.0/24</code> on <strong>R1-WE1</strong>.</p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_Routes_3.png" width="800"/></p>
<p><strong>Question: you will see 4 paths and one of the paths shows Inv,U. Hopefully you can answer why that is. But why are there 4 paths?</strong></p>
<p>Let's SSH to <strong>vSmart</strong> and do <code>show omp route vpn 1 10.100.100.0/24 | t</code>.</p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_Routes_4.png" width="800"/></p>
<p>You will see 12 ECMP routes marked as <strong>C,R</strong> (Chosen,Resolved). Why 12? This is because we have 4 DC wEdges each with 3 transports, so there are total of 12 paths. </n></p>
<p>The next question will be why there are only 4 paths on the remote wEdges? This is because the ECMP settings on the wEdge by default are set to 4. If you change it to the current maximum of 16, you will see all 12 paths.(It will be increased to a maximum of 128 in a future release) </n></p>
<p><span style="background-color:lightblue"> <strong>Note: vSmart randomly selects 4 paths (or whatever the max ECMP value is set to) and installs them on the device. This may pose problem in a large deployment where multiple paths is more than 16.</strong></p>
<p>In this exercise we will keep the default ECMP setting and solve this issue with a centralized policy.</p>
<h4 id="step-22-create-a-topology-for-centralized-policy"><strong>Step 2.2.</strong> Create a topology for centralized policy</h4>
<ul>
<li>
<p>Login to vManage <strong>198.18.133.200</strong> and access policy configuration from <strong>Configuration - Policies</strong></p>
</li>
<li>
<p>Click the <strong>Custom Options</strong> drop down on the top right and select <strong>Topology</strong> under <strong>Centralized Policy</strong></p>
</li>
<li>
<p>Click <strong>Add Topology</strong> under <strong>Topology</strong> and select <strong>Custom Control( Route&amp;TLOC )</strong></p>
</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_topo_1.png" width="800"/></p>
<p>You are going to create two topologies, one for each remote site.</p>
<ul>
<li>Create the topology policy for Remote1<ul>
<li>Name: <strong>LAB_Topo_RS1</strong></li>
<li>Description: <strong>LAB topology for Remote Site 1</strong></li>
<li>Click <strong>+Sequence Type</strong> and select <strong>Route</strong></li>
<li>Click <strong>+Sequence Rule</strong>, leave unchanged under Match(means match all)</li>
<li>Click <strong>Actions</strong> and change to <strong>Accept</strong> (we'll come back and do the route policy later).</li>
<li>Click <strong>Save Match And Actions</strong> to save the rule
<img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_topo_2.png" width="800"/></li>
<li>Click <strong>+Sequence Type</strong> then select <strong>TLOC</strong></li>
<li>Click <strong>+Sequence Rule</strong>, select <strong>TLOC</strong> for March condition</li>
<li>Under <strong>Match Conditions</strong>, selects <strong>DCs-BU1-TLOCs</strong> for <strong>TLOC List</strong> (this TLOC list has been pre-defined for you which includes all the TLOCs of DC1-WE1 and DC2-WE1</li>
<li>Click <strong>Actions</strong>, change Actions to <strong>Accept</strong></li>
<li>Click <strong>+Sequence Rule</strong>, select <strong>TLOC</strong></li>
<li>Under <strong>Match Conditions</strong>, selects <strong>RH_TLOCs</strong> for <strong>TLOC List</strong> (this TLOC list has been pre-defined for you which includes all the TLOCs of RH)</li>
<li>Click <strong>Actions</strong>, change Actions to <strong>Accept</strong></li>
<li>Click <strong>Save Match And Actions</strong> to save the rule</li>
</ul>
</li>
<li>Then click save Control Policy.</li>
</ul>
<p>This policy effectively allows R1-WE1 to build tunnels to all the DCs-BU1 devices (DC1-WE1 and DC2-WE1) as well as RH. Nothing else is allowed as the default action is reject.</p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_topo_3.png" width="800"/></p>
<ul>
<li>Follow the above steps and create another topology for Remote2 with the following settings:<ul>
<li>Name: <strong>LAB_Topo_RS2</strong></li>
<li>Description: <strong>LAB topology for Remote Site 2</strong></li>
<li>Click <strong>+Sequence Type</strong> then select <strong>Route</strong></li>
<li>Click <strong>+Sequence Rule</strong>, leave unchanged under Match(means match all),</li>
<li>Click <strong>Actions</strong> change Actions to <strong>Accept</strong> (we'll come back and do the route policy later).
<img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_topo_4.png" width="800"/></li>
<li>Click <strong>+Sequence Type</strong> then select <strong>TLOC</strong></li>
<li>Click <strong>+Sequence Rule</strong>, select <strong>TLOC</strong> for March condition</li>
<li>Under <strong>Match Conditions</strong>, selects <strong>DCs-BU2-TLOCs</strong> for <strong>TLOC List</strong> (this TLOC list has been pre-defined for you which includes all the TLOCs of DC1-WE2 and DC2-WE2)</li>
<li>Click <strong>Actions</strong>, change Actions to <strong>Accept</strong></li>
<li>Click <strong>Save Match And Actions</strong> to save the rule    </li>
<li>Click <strong>+Sequence Rule</strong>, select <strong>TLOC</strong></li>
<li>Under <strong>Match Conditions</strong>, selects <strong>RH-TLOCs</strong> for <strong>TLOC List</strong> (this TLOC list has been pre-defined for you which includes all the TLOCs of RH)</li>
<li>Click <strong>Actions</strong>, change Actions to <strong>Accept</strong></li>
<li>Click <strong>Save Match And Actions</strong> to save the rule    </li>
</ul>
</li>
<li>Then click save Control Policy.</li>
</ul>
<p>This policy effectively allows R2-WE1 to build tunnels to all the DCs-BU1 devices (DC1-WE2 and DC2-WE2) as well as RH. Nothing else is allowed as the default action is reject.</p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_topo_5.png" width="800"/></p>
<h4 id="step-23-apply-the-topology-policy-to-centralized-policy"><strong>Step 2.3.</strong> Apply the topology policy to Centralized Policy</h4>
<ul>
<li>Login to vManage <strong>198.18.133.200</strong> and access policy configuration from <strong>Configuration - Policies</strong></li>
<li>Click <strong>Add Policy</strong> under <strong>Centralized Policy</strong></li>
<li>Click next, you will see Configure Topology and VPN membership - Click <strong>Add topology</strong>, and select <strong>Import Existing Topology</strong></li>
<li>Click <strong>Custom Control(Route and TLOC)</strong>, then select <strong>LAB_Topo_RS1</strong></li>
<li>Click on Add Topology</li>
<li>Follow the steps above to add topology <strong>LAB_Topo_RS2</strong> as well</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_topo_6.png" width="800"/></p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_topo_7.png" width="800"/></p>
<ul>
<li>Click <strong>Next</strong> and proceed to the last step for Applying Policies to Sites and VPNs<ul>
<li>Policy Name: <strong>LAB_Central_v01</strong></li>
<li>Description: <strong>Task2 Topo only</strong></li>
<li>Click New Site List Under <strong>LAB_Topo_RS1</strong>, under <strong>Outbound Site List</strong>, select <strong>RS1</strong>,then click on Add</li>
<li>Click New Site List Under <strong>LAB_Topo_RS2</strong>, under <strong>Outbound Site List</strong>, select <strong>RS2</strong>,then click on Add
then click Save Policy</li>
</ul>
</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_topo_8.png" width="800"/></p>
<h4 id="step-24-activate-the-first-centralized-policy"><strong>Step 2.4.</strong> Activate the first Centralized Policy</h4>
<ul>
<li>Login to vManage <strong>198.18.133.200</strong> and access policy configuration from <strong>Configuration - Policies - Centralized Policy</strong></li>
<li>Locate policy <strong>LAB_Centeral_v01</strong> you have created in previous step. Click <strong>...</strong> for more options and select <strong>Activate</strong>. The policy will be pushed to the vSmarts.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_topo_9.png" width="800"/></p>
<h4 id="step-25-verify-the-hub-spoke-topology"><strong>Step 2.5.</strong> Verify the hub &amp; spoke topology</h4>
<ul>
<li>SSH to R1-WE1 &amp; R2-WE1 and run <code>show sdwan bfd sessions</code>command</li>
<li>Verify there is no bfd session between R1-WE1 and R2-WE1</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_topo_10.png" width="800"/>
<img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task2_topo_11.png" width="800"/></p>
<h2 id="task-3-default-route-handling">Task 3: Default Route handling</h2>
<p>In this task. you will configure the central policy to prefer the default route learned from DC over RH. You will need to modify the Centralized policy so that the default route from DC has higher OMP preference over RH.</p>
<h4 id="step-31-new-central-policy"><strong>Step 3.1.</strong>  New Central Policy</h4>
<ul>
<li>Make a new version of the topology policy.</li>
</ul>
<p><span style="background-color:lightblue"> <strong>Note: In production network, it is always recommended to create a new version when you update your policy. So that you can also change to the previous version as a fallback plan.</strong></p>
<ul>
<li>Login to vManage <strong>198.18.133.200</strong> and access policy configuration from <strong>Configuration - Policies</strong></li>
<li>Click the <strong>Custom Options</strong> drop down on the top right and select <strong>Topology</strong> under <strong>Centralized Policy</strong></li>
<li>Locate policy <strong>LAB_Topo_RS1</strong>, click <strong>...</strong> and select <strong>Copy</strong>.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_1.png" width="800"/>
- Provide a name and description for the new policy
    - Name: <strong>LAB_Topo_RS1_V02</strong>
    - Description: <strong>+Default Route handling</strong></p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_2.png" width="800"/></p>
<h4 id="step-32-edit-the-new-topology-policy"><strong>Step 3.2.</strong> Edit the new topology policy.</h4>
<ul>
<li>Click the <strong>Custom Options</strong> drop down on the top right and select <strong>Topology</strong> under <strong>Centralized Policy</strong></li>
<li>Locate <strong>LAB_Topo_RS1_V02</strong> and click <strong>...</strong> select <strong>Edit</strong></li>
</ul>
<p><span style="background-color:lightblue"> <strong>Note: there is one existing accept all rule; you don't need to change the accept all rule but you do need make sure the new rules are placed ahead of this accept all rule.</strong></p>
<ul>
<li>For <strong>Sequence Type</strong> Route rule, you are going to add four new rules<ul>
<li>Rule1: match <strong>Prefix List</strong> default &amp; <strong>originator</strong> of 1.1.10.1(DC1-WE1) then accept and set preference of 100</li>
<li>Rule2: match default &amp; originator of 1.1.20.1(DC2-WE1) then accept and set preference of 100</li>
<li>Rule3: match default &amp; site-list <strong>RH</strong> then <strong>accept</strong></li>
<li>Rule4: match default and then <strong>reject</strong></li>
</ul>
</li>
<li>Drag &amp; drop the newly created rules to move it ahead of the previous accept all rule.</li>
</ul>
<p><span style="background-color:lightblue"> <strong>Note: vSmart does the lookup based on the order. If it finds the match, it will use that rule and it won't look for any subsequent rules.</strong></p>
<ul>
<li>Click <strong>Save Control policy</strong>.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_3.png" width="800"/></p>
<h4 id="step-33-apply-the-policy"><strong>Step 3.3.</strong> Apply the policy</h4>
<ul>
<li>
<p>Login to vManage <strong>198.18.133.200</strong> and access policy configuration from <strong>Configuration - Policies</strong></p>
</li>
<li>
<p>Locate centralized policy <strong>LAB_Central_v01</strong>, click <strong>...</strong> and select <strong>Edit</strong></p>
</li>
</ul>
<p><span style="background-color:lightblue"> <strong>Note: In production deployment, you always want to use the same practice of copying the current policy then apply it.</strong></p>
<ul>
<li>Under <strong>Topology</strong> tab, select <strong>LAB_Topo_RS1</strong>. Click <strong>...</strong> and select <strong>Detach</strong> to remove this topology.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_4.png" width="800"/></p>
<ul>
<li>Click <strong>Add Topology</strong>, select <strong>Import Existing Topology</strong> and then select <strong>LAB_Topo_RS1_V02</strong>, and click Import.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_5.png" width="800"/></p>
<ul>
<li>Click on <strong>Policy Application</strong></li>
<li>Under <strong>LAB_Topo_RS1_V02 - Outbound Site List</strong>, click <strong>New Site List</strong> and select <strong>RS1</strong>.</li>
<li>Click <strong>Add</strong>, Save Policy Changes to Activate.</li>
</ul>
<p><span style="background-color:lightblue"> <strong>Note: The Outbound and Inbound options are from the vSmart's perspective where outbound policy means how the routes are sent out from vSmart; inbound policy means how the routes are sent to the vSmart.</strong></p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_6.png" width="800"/></p>
<h4 id="step-34-verify-change-of-default-route"><strong>Step 3.4.</strong> Verify change of default route</h4>
<ul>
<li>SSH to <strong>R1-WE1</strong> and do <code>show sdwan omp route</code> and check the learned TLOC for the default route as well as preference.
</n></li>
</ul>
<p><span style="background-color:yellow"> <strong>We're expecting the routes which are learned from DC1-WE1 and DC2-WE1 with preference of 100. However, the output shows the routes are not changed at all, the three installed routes are still learned from RH and no preference set either. Why is that?</strong></p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_7.png" width="800"/></p>
<p>Let's check omp route table on the vSmart, SSH to vSmart and run <code>show omp route | t</code>. </n></p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_8.png" width="800"/></p>
<p>As you recall, the OMP routes don't have any changes either where 3 paths learned from RH are marked with C,R due to routes being originated from Static which are preferred over originated from iBGP. But why doesn't the outbound policy that is setting the routes originated from DC1-WE1 and DC2-WE1 work? <strong>This is because by default the outbound policy will only apply to the routes with "C,R", the routes without "C,R" are not applicable</strong>. So the routes from DCs are not even going through the outbound policies. There are multiple ways to change this default behavior such as using inbound policy or configure send-backup path, or make every route with C.R. In this lab, we are going to use inbound policy to influence the route.</p>
<p>Let's configure an vSmart <strong>inbound policy</strong> to make the default routes learned from DCs have a higher OMP preference than RH's.</p>
<p><span style="background-color:lightblue"> <strong>Note: Using vSmart inbound policy may not be an ideal solution for all scenarios. It is recommended to use outbound policy, because it is simple and maintains full visibility of vSmart. vSmart inbound policy can be considered only if outbound policy can NOT meet the requirements.</strong></p>
<h4 id="step-35-create-new-topology"><strong>Step 3.5.</strong> Create new topology</h4>
<ul>
<li>Login to vManage <strong>198.18.133.200</strong> and access policy configuration from <strong>Configuration - Policies</strong></li>
<li>Click <strong>Custom Options</strong> on the upper right corner and select <strong>Topology</strong> under <strong>Centralized Policy</strong>.</li>
<li>Click <strong>Add Topology</strong> and select <strong>Custom Control(Route&amp;TLOC)</strong></li>
<li>Configure the new policy with following setting<ul>
<li>Name: <strong>default_route_from_DC</strong></li>
<li>Description: <strong>default_route_from_DC</strong></li>
<li>Click <strong>+Sequence Type</strong> and select <strong>TLOC</strong></li>
<li>Click <strong>+Sequence Rule</strong><ul>
<li>leave unchange Under <strong>Match Conditions</strong>(means match all)</li>
<li>Click <strong>Actions</strong>, change action to <strong>Accept</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_9a.PNG" width="800"/>  </p>
<ul>
<li>Click <strong>+Sequence Type</strong> and select <strong>Route</strong></li>
<li>Click <strong>+Sequence Rule</strong><ul>
<li>Click <strong>Prefix List</strong> and <strong>Site</strong> under <strong>Match</strong>  </li>
<li>Under <strong>Match Conditions</strong>, select <strong>default</strong> from <strong>Prefix List</strong> dropdown</li>
<li>Under <strong>Match Conditions</strong>, select <strong>DCs</strong> from <strong>Site List</strong> dropdown</li>
<li>Click <strong>Actions</strong> select <strong>Accept</strong>; add <strong>Preference</strong> with value <strong>50</strong></li>
</ul>
</li>
<li>Click <strong>+Sequence Rule</strong> to add catch-all rule<ul>
<li>leave unchange Under <strong>Match Conditions</strong>(means match all)</li>
<li>Click <strong>Actions</strong> select <strong>Accept</strong>; add <strong>Preference</strong> with value <strong>0</strong></li>
<li>Click <strong>Save Match And Actions</strong> and <strong>Save Control Policy</strong></li>
</ul>
</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_9.png" width="800"/></p>
<ul>
<li>Apply this new topology to the current policy.</li>
<li>Login to vManage <strong>198.18.133.200</strong> and access policy configuration from <strong>Configuration - Policies</strong></li>
<li>Locate <strong>LAB_Central_v01</strong> under Centralized Policy and select <strong>Edit</strong></li>
<li>Click Topology tab and click <strong>Add Topology</strong></li>
<li>Select <strong>Import Existing Topology</strong> and select <strong>Custom Control( Route and TLOC)</strong> Policy Type then select <strong>default_route_from_DC</strong> from drop down; click Import.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_10.png" width="800"/></p>
<ul>
<li>Click on <strong>Policy Application</strong>, click on <strong>New Site List</strong> under <strong>Inbound Site List</strong>, select <strong>DCs</strong>.</li>
<li>Click on Add and <strong>Save Policy Changes</strong> to Activate.</li>
</ul>
<p><span style="background-color:lightblue"> <strong>Note: This time there is an inbound policy where the inbound policy controls how vSmart sees the routes.</strong></p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_11.png" width="800"/></p>
<h4 id="step-36-verify"><strong>Step 3.6.</strong> Verify</h4>
<ul>
<li>SSH to the vSmart and run <code>show omp route vpn 1 | t</code></li>
<li>Here you will see the routes from both DCs are C,R with preference 50 now which is expected.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_12.png" width="800"/></p>
<ul>
<li>SSH to <strong>R1-WE1</strong> and do <code>show sdwan omp route vpn 1</code>. You will see 4 paths from DCs with preference 100. Remember the vSmart outbound policy we assign preference of 100 where the inbound policy we assign preference of 50 so that we can differentiate which policy is taking effect.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_13.png" width="800"/></p>
<p><strong>Well done! You have finished the default route handling task for R1-WE1.Let's configure the same policy for R2-WE1.</strong></p>
<h4 id="step-37-create-topology-policy-for-remote2"><strong>Step 3.7.</strong> Create topology policy for Remote2</h4>
<ul>
<li>Login to vManage <strong>198.18.133.200</strong> and access policy configuration from <strong>Configuration - Policies</strong></li>
<li>Click <strong>Custom Options</strong> on the upper right corner and select <strong>Topology</strong> under <strong>Centralized Policy</strong>.</li>
<li>Locate <strong>LAB_Topo_RS1_V02</strong> click <strong>...</strong> select copy and change Name and Description to <strong>LAB_Topo_RS2_v02</strong> then click Copy.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_14.png" width="800"/></p>
<ul>
<li>Locate newly created <strong>LAB_Topo_RS2_v02</strong>. click <strong>...</strong> select Edit</li>
<li>Select <strong>TLOC</strong> as the Sequence Type; select <strong>Rule1</strong> and click the pencil to <strong>Edit</strong>.</li>
</ul>
<p><span style="background-color:lightblue"> <strong>Note: We need to change the TLOC List from BU1 to BU2 as we'd like to use the BU2's functional hub which are DC1-WE2 and DC2-WE2 as the entry point for remote site 2(Remember remote site 2 represents the remote sites for BU2, where remote site 1 represents the remote sites for BU1).</strong></p>
<ul>
<li>Remove <strong>DCs-BU1-TLOCs</strong> by clicking the <strong>x</strong>, then select <strong>DCs-BU2-TLOCs</strong> and click <strong>Save Match and Actions</strong>.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_TLOC_15.png" width="800"/></p>
<ul>
<li>Select <strong>Route</strong> as the <strong>Sequence Type</strong>, you need to change the <strong>originator</strong> from <strong>1.1.10.1</strong> to <strong>1.1.10.2</strong> and <strong>1.1.20.1</strong> to <strong>1.1.20.2</strong>. By doing this, default route from DC1-WE2 and DC2-WE2 will have OMP preference of 100 sent to R2-WE2 site.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_15.png" width="800"/></p>
<ul>
<li>After <strong>Save Control Policy</strong>, access the <strong>Centralized Policy</strong> from <strong>Configuration - Policies</strong></li>
<li>Locate <strong>LAB_Central_v01</strong> and select <strong>Edit</strong>  </li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_16.png" width="800"/></p>
<ul>
<li>Under <strong>Topology</strong> tab, click <strong>Add Topology</strong> and select <strong>Import Existing Topology</strong></li>
<li>Change Policy Type to <strong>Custom Control( Route and TLOC )</strong>; select <strong>LAB_Topo_RS2_V02</strong> and Import.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_17.png" width="800"/></p>
<ul>
<li>Select existing topology <strong>LAB_Topo_RS2</strong>, click <strong>detach</strong> to remove it from Centralized Policy.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_18.png" width="800"/></p>
<ul>
<li>Click <strong>Policy Application</strong>; under <strong>LAB_Topo_RS2_V02</strong> click <strong>New Site List</strong> and select <strong>RS2</strong> as outbound site list.</li>
<li>Click Add, and <strong>Save Policy Changes</strong> to Activate.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_19.png" width="800"/></p>
<ul>
<li>Once the policy has been pushed to vSmart, let's verify.</li>
<li>SSH to <strong>R2-WE1</strong> and run <code>show ip route vrf 1</code>. Now, the default route has two ECMP paths, one path for each DC.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_20.png" width="800"/>
- Do <code>show sdwan omp route vpn 1</code>.You will see that there are 4 paths in the OMP route table, however none of them is valid.</p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task3_routes_21.png" width="800"/></p>
<h2 id="task-4-specific-routes-handling">Task 4: Specific Routes handling</h2>
<p>ACME wants to prefer more specific routes originated from its DC and use the other DC as backup. For BU1 (R1-WE1), it only needs to learn the routes from BU1's Headend devices (DC1-WE1 and DC2-WE1); for BU2(R2-WE1), it onlys need to learn the routes from BU2's Headend devices.(DC1-WE2 and DC2-WE2).
</n></p>
<p>The specific routes from DC1 are tagged with 1000; DC2 are tagged with 2000 in previous task. In this section, you are going to create different policies for BU1 and BU2 sites and set different OMP preference based on OMP tag.</p>
<h4 id="step-41-modify-topology-policy-for-remote1">Step 4.1: Modify Topology policy for remote1</h4>
<ul>
<li>Login to vManage <strong>198.18.133.200</strong> and access policy configuration from <strong>Configuration - Policies</strong></li>
<li>Click <strong>Custom Options</strong> on the upper right corner and select <strong>Topology</strong> under <strong>Centralized Policy</strong>.</li>
<li>Locate topology <strong>LAB_Topo_RS1_V02</strong>. click <strong>...</strong> and select <strong>Edit</strong></li>
<li>Select <strong>Route</strong> under <strong>Sequence Type</strong>, you are going to add four more rules.</li>
<li>Rule1<ul>
<li>Click <strong>Sequence Rule</strong>, select <strong>OMP Tag</strong> and <strong>TLOC</strong> for match condition</li>
<li>Under <strong>Match Conditions</strong>, type <strong>1000</strong> in <strong>OMP Tag</strong>; <strong>DC1-BU1-TLOCs</strong> in <strong>TLOC List</strong></li>
<li>Click <strong>Actions</strong>, change to <strong>Accept</strong> and set <strong>Preference</strong> of 100.</li>
<li>Click <strong>Save Match And Actions</strong></li>
</ul>
</li>
<li>rule2<ul>
<li>Click <strong>Sequence Rule</strong>, select <strong>OMP Tag</strong> and <strong>TLOC</strong> for match condition</li>
<li>Under <strong>Match Conditions</strong>, type <strong>1000</strong> in <strong>OMP Tag</strong>; <strong>DC2-BU1-TLOCs</strong> in <strong>TLOC List</strong></li>
<li>Click <strong>Actions</strong>, change to <strong>Accept</strong> and set <strong>Preference</strong> of 50</li>
<li>Click <strong>Save Match And Actions</strong></li>
</ul>
</li>
<li>rule3<ul>
<li>Click <strong>Sequence Rule</strong>, select <strong>OMP Tag</strong> and <strong>TLOC</strong> for match condition</li>
<li>Under <strong>Match Conditions</strong>, type <strong>2000</strong> in <strong>OMP Tag</strong>; <strong>DC2-BU1-TLOCs</strong> in <strong>TLOC List</strong></li>
<li>Click <strong>Actions</strong>, change to <strong>Accept</strong> and set <strong>Preference</strong> of 100.</li>
<li>Click <strong>Save Match And Actions</strong>  </li>
</ul>
</li>
<li>rule4<ul>
<li>Click <strong>Sequence Rule</strong>, select <strong>OMP Tag</strong> and <strong>TLOC</strong> for match condition</li>
<li>Under <strong>Match Conditions</strong>, type <strong>2000</strong> in <strong>OMP Tag</strong>; <strong>DC1-BU1-TLOCs</strong> in <strong>TLOC List</strong></li>
<li>Click <strong>Actions</strong>, change to <strong>Accept</strong> and set <strong>Preference</strong> of 50</li>
<li>Click <strong>Save Match And Actions</strong></li>
</ul>
</li>
<li>Drag and Drop to move up the newly created rules above the <strong>accept all</strong> rule. (if you followed the previously task, the new rules should be No. 5, 6,7 and 8, and the match all rule should be rule No. 9)</li>
</ul>
<p><span style="background-color:lightblue"> <strong>Note: vSmart does the lookup based upon the order from top down, When a match is found, it will use that rule and stop processing the sequence(it will not longer look for subsequent rules).</strong></p>
<ul>
<li>Click <strong>Save policy</strong> to Activate. This will make the vSmart to push the policy immediately after you confirm configuring devices</li>
</ul>
<p><strong>This is expected, creating a new policy is a best practice. Otherwise updating the existing active policy will cause an immediate policy push.</strong></p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task4_routes_1.png" width="800"/></p>
<ul>
<li>To verify, SSH to <strong>R1-WE1</strong> and run <code>show sdwan omp route vpn 1</code></li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task4_routes_2.png" width="800"/></p>
<p>Here we can see 4 paths for 10.100.100.0/24, however we see 3 paths with preference of 100. One path doesn't have any preference; For 10.200.200.0/24, there are 4 paths however 3 paths have a preference of 50, one path doesn't have any preference. If you look at it closely you will notice that the paths picked are from the lowest system-ip.</p>
<p>This is because by default vSmart will only send 4 paths to the wEdges. When vSmart is going through the outbound policy, it takes a route from vsmart route table in the winning order (marked as C,R) and compare it with the outbound policy as long as there is a match (permit) in the policy for a particular prefix, it will send it out and count it as one until it hits the send-path-limits which is 4 by default. Since in our route-policy, we have a permit all at the end which means every route will have a match, therefore first 4 routes in the winning order are sent out regardless which rule they're matching in the policy. There are multiple ways to fix this, the simple way is to change the limit to 16 on both vSmart as well as on the wEdges.</p>
<h4 id="step-42-configure-16-paths-ecmp">Step 4.2: Configure 16 paths ECMP</h4>
<ul>
<li>Configure vSmart to send 16 paths</li>
<li>
<ul>
<li>Access template configuration from <strong>Configuration - Templates</strong></li>
</ul>
</li>
<li>Under <strong>Device</strong> template tab, locate template <strong>vSmart</strong> and select <strong>Edit</strong></li>
<li>Under <strong>OMP</strong> config section, add configure <strong>send-path-limit 16</strong>. Click update to complete the configuration.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task4_routes_3.png" width="800"/></p>
<ul>
<li>Change ecmp-limit to 16 on the wEdges.</li>
<li>Access template configuration from <strong>Configuration - Templates</strong></li>
<li>Under the <strong>Feature</strong> template tab, locate template <strong>Lab_OMP_V01</strong> and select <strong>Edit</strong></li>
<li>Under the <strong>Basic Configuration</strong> section, change <strong>ECMP</strong> to <strong>16</strong> as Global variable.</li>
<li>Click update to push configuration changes.</li>
</ul>
<p><span style="background-color:lightblue"> <strong>Note: This OMP feature template is used on all device templates. Where we modify this one feature template, it will change the configuration on all devices, in our case on all 7 WAN Edges.</strong></p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task4_routes_4.png" width="800"/></p>
<h4 id="step-43-verification">Step 4.3: Verification</h4>
<ul>
<li>
<p>SSH to <strong>R1-WE1</strong> and run <code>show sdwan omp route vpn 1</code></p>
</li>
<li>
<p>You should see each route for (10.100.100.0/24 and 10.200.200.0/24) will have 12 paths and 3 paths from the preferred DC with preference of 100, 3 paths from secondary DC with preference of 50, another 6 paths from are invalid from other BU hub devices.</p>
</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task4_routes_5.png" width="800"/></p>
<ul>
<li>Now run <code>show ip route vrf 1</code>
You will see route 10.100.100.0/24 is learned from 1.1.10.1, and route 10.200.200.0/24 is learned from 1.1.20.1 which is desired.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task4_routes_6.png" width="800"/></p>
<h4 id="step-44-modify-topology-policy-for-remote2">Step 4.4: Modify Topology policy for remote2</h4>
<ul>
<li>Login to vManage <strong>198.18.133.200</strong> and access policy configuration from <strong>Configuration - Policies</strong></li>
<li>Click <strong>Custom Options</strong> on the upper right corner and select <strong>Topology</strong> under <strong>Centralized Policy</strong>.</li>
<li>locate topology <strong>LAB_Topo_RS2_V02</strong>. click <strong>...</strong> and select <strong>Edit</strong></li>
<li>Select <strong>Route</strong> under <strong>Sequence Type</strong>. Here you are going to add four more rules.</li>
<li>Rule1:<ul>
<li>Click <strong>Sequence Rule</strong>, select <strong>OMP Tag</strong> and then <strong>TLOC</strong> for match condition</li>
<li>Under <strong>Match Conditions</strong>, type <strong>1000</strong> in <strong>OMP Tag</strong>; <strong>DC1-BU2-TLOCs</strong> in <strong>TLOC List</strong></li>
<li>Click <strong>Actions</strong>, change to <strong>Accept</strong> and set the <strong>Preference</strong> of 100.</li>
<li>Click <strong>Save Match And Actions</strong></li>
</ul>
</li>
<li>Rule2:<ul>
<li>Click <strong>Sequence Rule</strong>, select <strong>OMP Tag</strong> and then <strong>TLOC</strong> for match condition</li>
<li>Under <strong>Match Conditions</strong>, type <strong>1000</strong> in <strong>OMP Tag</strong>; <strong>DC2-BU2-TLOCs</strong> in <strong>TLOC List</strong></li>
<li>Click <strong>Actions</strong>, change to <strong>Accept</strong> and set the <strong>Preference</strong> of 50</li>
<li>Click <strong>Save Match And Actions</strong></li>
</ul>
</li>
<li>Rule3:<ul>
<li>Click <strong>Sequence Rule</strong>, select <strong>OMP Tag</strong> and then <strong>TLOC</strong> for match condition</li>
<li>Under <strong>Match Conditions</strong>, type <strong>2000</strong> in <strong>OMP Tag</strong>; <strong>DC2-BU2-TLOCs</strong> in <strong>TLOC List</strong></li>
<li>Click <strong>Actions</strong>, change to <strong>Accept</strong> and set the <strong>Preference</strong> of 100.</li>
<li>Click <strong>Save Match And Actions</strong>  </li>
</ul>
</li>
<li>Rule4:<ul>
<li>Click <strong>Sequence Rule</strong>, select <strong>OMP Tag</strong> and then <strong>TLOC</strong> for match condition</li>
<li>Under <strong>Match Conditions</strong>, type <strong>2000</strong> in <strong>OMP Tag</strong>; <strong>DC1-BU2-TLOCs</strong> in <strong>TLOC List</strong></li>
<li>Click <strong>Actions</strong>, change to <strong>Accept</strong> and set the <strong>Preference</strong> of 50</li>
<li>Click <strong>Save Match And Actions</strong></li>
</ul>
</li>
<li>Drag and Drop to move up the newly created rules above the <strong>accept all</strong> rule. (if you followed the previous tasks, the new rules should be No. 5, 6,7 and 8, match all rule should be rule No. 9)</li>
</ul>
<p><span style="background-color:lightblue"> <strong>Note: vSmart does the lookup based on the order from top down. When a match is found, it will use that rule and stop processing the sequence (it will no longer look for subsequent rules).</strong></p>
<ul>
<li>click <strong>Save policy</strong> to Activate. This will make the vSmart to push the policy immediately after you confirm configuring devices</li>
</ul>
<p><strong>This is expected, creating a new policy is a best practice. Otherwise updating the existing active policy will cause an immediate policy push.</strong></p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task4_routes_7.png" width="800"/></p>
<h4 id="step-45-verification">Step 4.5: Verification</h4>
<ul>
<li>
<p>SSH to <strong>R2-WE1</strong> and run <code>show sdwan omp route vpn 1</code></p>
</li>
<li>
<p>Here you can see each route (10.100.100.0/24 and 10.200.200.0/24) will have 12 paths - however 3 paths from the preferred DC have a preference of 100, 3 paths from the secondary DC have a preference of 50, and another 6 paths from are invalid from other BU hub devices.</p>
</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task4_routes_8.png" width="800"/></p>
<ul>
<li>
<p>Run <code>show ip route vrf 1</code></p>
</li>
<li>
<p>Here you will see 10.100.100.0/24 is learned from 1.1.10.2; 10.200.200.0/24 is learned from 1.1.20.2 which is desired.</p>
</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task4_routes_9.png" width="800"/></p>
<h6 id="this-concludes-the-routing-handling-for-the-specific-routes"><strong>This concludes the routing handling for the specific routes.</strong></h6>
<h2 id="task-5-application-aware-routing">Task 5: Application Aware Routing</h2>
<p>ACME wants to provide the best user experience for their transactional data which has to meet the below SLA requirement ( we will use SSH to simulate this). ACME would also like to use private 1 as the preferred link, if private 1 doesn't meet the SLA requirement, it will use private 2 when private 2 still meets the SLA. The LTE link will only be used when both private 1 and private 2 go down. ACME has the following SLA requirements for their applications.</p>
<table>
<thead>
<tr>
<th align="center">Application</th>
<th align="center">Loss(%)</th>
<th align="center">Lattency(msec)</th>
<th align="center">Jitter(msec)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>Transactional Data</strong></td>
<td align="center">5</td>
<td align="center">50</td>
<td align="center">100</td>
</tr>
<tr>
<td align="center"><strong>Bulk-Data</strong></td>
<td align="center">10</td>
<td align="center">300</td>
<td align="center">100</td>
</tr>
<tr>
<td align="center"><strong>Voice-and-Video</strong></td>
<td align="center">2</td>
<td align="center">45</td>
<td align="center">100</td>
</tr>
<tr>
<td align="center"><strong>Default</strong></td>
<td align="center">25</td>
<td align="center">300</td>
<td align="center">100</td>
</tr>
</tbody>
</table>
<p>Solution: Application Aware Routing (AAR) is one of the differentiator between SDWAN and traditional WAN technology where you can route traffic based upon an application's SLA. You can classify an application based upon traditional 5 tuples or even application's DPI(Deep Packet Inspection). There three action keyword for the selected application. Prefer; backup and strict. The key to remember is AAR is all about SLA.</p>
<p>Prefer means when the preferred color/s meets the SLA, this/these colors will be preferred. If all the preferred colors don't meet the SLA, then depending on if you have backup or strict configuration, these two options are mutual exclusive.</p>
<p>If the backup color is configured which means when preferred color doesn't meet SLA, it will first use all other colors that meet the SLA regardless if that color is configured as backup or not (as long as the color meets the SLA). If there are multiple such colors, it will perform load sharing among them. If none of the colors meet the SLAs, it will use the configured backup color.</p>
<p>If strict is configured (note: strict and backup are mutual exclusive ), the matching traffic will be dropped when the preferred color is not configured.</p>
<p>Based upon the requirements, we will do the following: first configure LTE as the last resort which means it won't come up until all other circuits are not available. Then we will configure private1 as preferred color, and we simply don't need to mention private2 (because if private2 meets the SLA it will be used anyway). If private2 doesn't meet SLA, since neither strict nor backup is configured, it will simply use any available tunnels that are left.</p>
<h4 id="step-51-configure-the-rh-lte-interface-be-used-only-when-all-other-circuits-are-unavailable">Step 5.1: Configure the RH LTE interface be used only when all other circuits are unavailable.</h4>
<ul>
<li>Access template configuration from <strong>Configuration - Templates</strong></li>
<li>Under <strong>Feature</strong> template tab, locate template <strong>Lab_RH_VPN0_LTE_V01</strong> and select <strong>Edit</strong></li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_LTE_1.png" width="800"/></p>
<ul>
<li>Under the <strong>Tunnel</strong> section, expand <strong>Advanced Options</strong></li>
<li>Change <strong>Last-Resort Circuit</strong> to <strong>Device Specific</strong> and give it the variable name <strong>vpn_if_tunnel_last_resort_circuit</strong>.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_LTE_1a.png" width="800"/></p>
<ul>
<li>Click <strong>Update</strong> to trigger device configure change.</li>
<li>Select <strong>vpn_if_tunnel_last_resort_circuit</strong> checkbox and <strong>Update</strong> to push configure change</li>
</ul>
<p>This setting will make LTE the last-resort which means the interface will go down, and no other traffic use it until all other circuits become unavailable.</p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_LTE_2.png" width="800"/></p>
<h4 id="step-52-last-resort-verification">Step 5.2: Last-Resort verification.</h4>
<ul>
<li>SSH to <strong>RH-WE</strong> and run <code>show ip int brief</code></li>
<li>Here you will notice Gig3 and Tunnel3 are both down.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_LTE_3.png" width="800"/></p>
<ul>
<li>Run <code>show sdwan control connections</code>. Notice there is no control connections on the LTE interface.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_LTE_4.png" width="800"/></p>
<ul>
<li>Run <code>show sdwan bfd sessions</code>. Notice there is no IPSec tunnel over LTE either.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_LTE_5.png" width="800"/></p>
<h4 id="step-53-configure-sla-classes-for-app-aware-routing-aar">Step 5.3: Configure SLA classes for app aware routing (AAR)</h4>
<ul>
<li>Login to vManage <strong>198.18.133.200</strong> and access policy configuration from <strong>Configuration - Policies</strong></li>
<li>Click <strong>Custom Options</strong> drop down on the top right and select <strong>Lists</strong> under <strong>Centralized Policy</strong></li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_1.png" width="800"/></p>
<ul>
<li>Select <strong>SLA Class</strong> and confirm the classes are defined properly.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_2.png" width="800"/></p>
<ul>
<li>Click <strong>Custom Options</strong> drop down on the top right and select <strong>Traffic Policy</strong> under <strong>Centralized Policy</strong></li>
<li>Select <strong>Application Aware Routing</strong> and <strong>Add Policy</strong> to create new
<img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_3.png" width="800"/></li>
<li>Configure the AAR policy with the setting below:<ul>
<li>Name: <strong>LAB_AAR_V01</strong></li>
<li>Description: <strong>LAB_AAR_V01</strong></li>
<li>click <strong>+Sequence Type</strong> and click <strong>Sequence Rule</strong></li>
<li>select <strong>Destination Port</strong> for <strong>Match</strong> condition</li>
<li>under <strong>Match Conditions</strong>, type <strong>22</strong> in destination port</li>
<li>click <strong>Actions</strong>, select <strong>SLA Class List</strong> and <strong>Counter</strong></li>
<li>under <strong>Actions</strong><ul>
<li>SLA Class: <strong>Transactional-Data</strong>  </li>
<li>Preferred Color: <strong>private1</strong></li>
<li>Counter: <strong>transactional-data</strong></li>
</ul>
</li>
</ul>
</li>
<li>Click <strong>Save Match And Actions</strong></li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_4.png" width="800"/></p>
<ul>
<li>Click 'Save Application Aware Routing Policy'</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_5.png" width="800"/></p>
<h4 id="step-54-apply-the-aar">Step 5.4: Apply the AAR</h4>
<ul>
<li>Access policy configuration from <strong>Configuration - Policies</strong></li>
<li>Locate <strong>LAB_Central_v01</strong> click <strong>...</strong> for more option and select <strong>Copy</strong></li>
<li>Name the new policy <strong>LAB_Central_v02</strong></li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_6.png" width="800"/></p>
<ul>
<li>Select the new policy <strong>LAB_Central_v02</strong>, click <strong>...</strong> for more option and select <strong>Edit</strong></li>
<li>Under <strong>Traffic Rules - Application Aware Routing</strong>, click <strong>Add Policy</strong> then <strong>Import Existing</strong>, select <strong>LAB_AAR_V01</strong> and Import.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_7.png" width="800"/></p>
<ul>
<li>Click <strong>Policy Application</strong> tab then select <strong>Application Aware Routing</strong><ul>
<li>Click <strong>New Site List and VPN List</strong> to add it<ul>
<li>New Site List: <strong>DCs and RH</strong></li>
<li>VPN List: <strong>VPN1</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Click on Add then <strong>Save Policy Changes</strong>
<img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_8.png" width="800"/></p>
</li>
<li>
<p>Activate <strong>LAB_Central_v02</strong> policy by clicking <strong>...</strong> and select <strong>activate</strong>.</p>
</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_9.png" width="800"/></p>
<h4 id="step-55-lab-verification">Step 5.5: Lab Verification</h4>
<ul>
<li>Login to vManage <strong>198.18.133.200</strong> and select <strong>Monitor - Network</strong> from the left panel</li>
<li>Click <strong>RH-WE1</strong> to bring up the device monitor page, and select <strong>Troubleshooting</strong> from the panel on the left</li>
<li>Select <strong>Simulate Flows</strong> tool under <strong>Traffic</strong> and use the following value for simulated flow<ul>
<li>VPN: <strong>VPN-1</strong></li>
<li>Source/Interface for VPN-1: <strong>Gigabithernet4 - ipv4 - 10.10.30.2</strong></li>
<li>Source IP: <strong>10.10.30.2</strong></li>
<li>Destination IP: <strong>10.100.100.100</strong></li>
<li>Click on <strong>Advanced Options</strong>:</li>
<li>Protocol: 6 (TCP)</li>
<li>Destination Port: 22</li>
<li>All Paths: Checked</li>
</ul>
</li>
<li>Click <strong>Simulate</strong></li>
</ul>
<p>You should see the traffic is only taking the private1 path which means it's using private1 as the preferred transport.</p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_10.png" width="800"/></p>
<p>Do another simulation, this time change the destination port to 23, everything else remains the same.</p>
<p>You should see the traffic will use both <strong>private1</strong> and <strong>private2</strong> which means it uses all available circuits for all other traffic.
<img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_11.png" width="800"/></p>
<ul>
<li>Now let's shutdown the private1 interface of the RH-WE1 and verify again.</li>
<li>Access template configuration from <strong>Configuration - Templates</strong></li>
<li>Locate device template <strong>Lab_RH_V01</strong>, click <strong>...</strong> and select <strong>Change Device Values</strong></li>
<li>Click <strong>...</strong> to select <strong>Edit Device Template</strong></li>
<li>Select the <strong>Shutdown(vpn_if_interface)</strong> checkbox under <strong>GigabitEthernet1</strong></li>
<li>Click Update -&gt; next to trigger the configuration change.</li>
</ul>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_12.png" width="800"/></p>
<ul>
<li>
<p>Now let's verify it again.</p>
</li>
<li>
<p>Login to vManage <strong>198.18.133.200</strong> and select <strong>Monitor - Network</strong></p>
</li>
<li>Click <strong>RH-WE1</strong> to bring up device monitor page, and select <strong>Troubleshooting</strong> from the panel on the left</li>
<li>Select <strong>Simulate Flows</strong> tool under <strong>Traffic</strong> and use the following value for simulated flow<ul>
<li>VPN: <strong>VPN-1</strong></li>
<li>Source/Interface for VPN-1: <strong>Gigabitethernet4 - ipv4 - 10.10.30.2</strong></li>
<li>Source IP: <strong>10.10.30.2</strong></li>
<li>Destination IP: <strong>10.100.100.100</strong></li>
<li>Click on <strong>Advanced Options</strong>:</li>
<li>Protocol: 6 (TCP)</li>
<li>Destination Port: 22</li>
<li>All Paths: Checked</li>
</ul>
</li>
<li>Click <strong>Simulate</strong></li>
</ul>
<p>You should see that traffic is only taking the private2 path now as this is the only color available.</p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_13.png" width="800"/></p>
<ul>
<li>Let's shutdown private2 interface and verify again</li>
<li>Access the Template configuration from <strong>Configuration - Templates</strong></li>
<li>Locate device template <strong>Lab_RH_V01</strong>, click <strong>...</strong> and select <strong>Change Device Values</strong></li>
<li>Click <strong>...</strong> to select <strong>Edit Device Template</strong></li>
<li>Select the <strong>Shutdown(vpn_if_interface)</strong> checkbox under <strong>GigabitEthernet2</strong></li>
<li>
<p>Click Update -&gt; next to trigger the configuration change.</p>
</li>
<li>
<p>Now let's verify it again.</p>
</li>
<li>
<p>Login to vManage <strong>198.18.133.200</strong> and select <strong>Monitor - Network</strong></p>
</li>
<li>Click <strong>RH-WE1</strong> to bring up the device monitor page, and select <strong>Troubleshooting</strong> from the panel on the left</li>
<li>Select <strong>Simulate Flows</strong> tool under <strong>Traffic</strong> and use the following value for simulated flow<ul>
<li>VPN: <strong>VPN-1</strong></li>
<li>Source/Interface for VPN-1: <strong>Gigabitethernet4 - ipv4 - 10.10.30.2</strong></li>
<li>Source IP: <strong>10.10.30.2</strong></li>
<li>Destination IP: <strong>10.100.100.100</strong></li>
<li>Click on <strong>Advanced Options</strong>:</li>
<li>Protocol: 6 (TCP)</li>
<li>Destination Port: 22</li>
<li>All Paths: Checked</li>
</ul>
</li>
<li>Click <strong>Simulate</strong></li>
</ul>
<p>You should see the traffic is taking LTE interface only.
<img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_14.png" width="800"/></p>
<p><strong>Great! You've completed lab1. Before you proceed to next lab, let's no shutdown private1 and private2 interfaces, and disable LTE last-resort by changing the device value of RH-WE1's device template.</strong></p>
<p><img src="https://ciscolivelab.github.io/HOLENT-2314/img/lab_task5_AAR_15.png" width="800"/></p>
<p><a href="JAVASCRIPT:scroll(0,0)" style="color:blue">Back to Top</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../intro2/" class="btn btn-neutral float-left" title="Getting Started"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../lab2/" class="btn btn-neutral float-right" title="Lab 2 Tasks">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../intro2/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../lab2/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
